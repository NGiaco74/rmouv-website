<!DOCTYPE html>
<html lang="fr-FR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R'MouV Admin - Connexion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                            primary: "#5A9FD4",
                            secondary: "#FFB347",
                        neutral: "#37474F"
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-primary/10 to-secondary/10 min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full space-y-8 p-8">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-primary">R'<span class="text-secondary">MouV</span></h1>
            <h2 class="mt-2 text-xl font-semibold text-gray-700">Espace Administrateur</h2>
            <p class="mt-2 text-sm text-gray-600">Connectez-vous pour gérer les réservations</p>
        </div>

        <!-- Login Form -->
        <div class="bg-white rounded-lg shadow-lg p-8">
            <form id="admin-login-form" class="space-y-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-envelope mr-2"></i>Email administrateur
                    </label>
                    <input type="email" id="email" name="email" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="admin@rmouv.fr">
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-lock mr-2"></i>Mot de passe
                    </label>
                    <input type="password" id="password" name="password" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="••••••••">
                </div>

                <button type="submit" 
                        class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i>Se connecter
                </button>
            </form>

            <!-- Demo Credentials -->
            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                <h3 class="text-sm font-medium text-blue-800 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>Identifiants de démonstration
                </h3>
                <div class="text-sm text-blue-700">
                    <p><strong>Email:</strong> admin@rmouv.fr</p>
                    <p><strong>Mot de passe:</strong> admin123</p>
                </div>
            </div>

            <!-- Back to main site -->
            <div class="mt-6 text-center">
                <a href="/" class="text-primary hover:text-primary/80 text-sm">
                    <i class="fas fa-arrow-left mr-2"></i>Retour au site principal
                </a>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-6 flex items-center space-x-4">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <span class="text-gray-700">Connexion en cours...</span>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('admin-login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const loginData = Object.fromEntries(formData);
            
            // Validate required fields
            if (!loginData.email || !loginData.password) {
                showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(loginData.email)) {
                showNotification('Veuillez entrer une adresse email valide', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erreur de connexion');
                }
                
                // Check if user is admin
                if (data.user.role !== 'admin') {
                    throw new Error('Accès administrateur requis');
                }
                
                // Store admin token
                localStorage.setItem('rmouv_admin_token', data.token);
                
                showNotification('Connexion réussie !', 'success');
                
                // Redirect to admin panel
                setTimeout(() => {
                    window.location.href = '/admin.html';
                }, 1000);
                
            } catch (error) {
                console.error('Erreur de connexion:', error);
                showNotification(error.message || 'Erreur de connexion', 'error');
            } finally {
                showLoading(false);
            }
        });

        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.toggle('hidden', !show);
        }

        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                color: white;
                font-weight: 500;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease-out;
                max-width: 400px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            `;

            const colors = {
                success: '#2E7D32',
                error: '#EF4444',
                info: '#1976D2',
                warning: '#F59E0B'
            };
            notification.style.backgroundColor = colors[type] || colors.info;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 4000);
        }

        // Check if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('rmouv_admin_token');
            if (token) {
                // Verify token
                fetch('/api/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(user => {
                    if (user.role === 'admin') {
                        window.location.href = '/admin.html';
                    }
                })
                .catch(() => {
                    localStorage.removeItem('rmouv_admin_token');
                });
            }
        });
    </script>
</body>
</html>
